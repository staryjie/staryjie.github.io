(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{460:function(s,a,t){"use strict";t.r(a);var e=t(2),n=Object(e.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("说明")]),s._v(" "),a("p",[s._v("Kubernetes面试题")])]),s._v(" "),a("h1",{attrs:{id:"kubernetes面试题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes面试题"}},[s._v("#")]),s._v(" Kubernetes面试题")]),s._v(" "),a("h2",{attrs:{id:"_1、docker与虚拟机有什么不同"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1、docker与虚拟机有什么不同"}},[s._v("#")]),s._v(" 1、Docker与虚拟机有什么不同？")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://static.staryjie.com/static/images/2022-09-16_08-59-17-275.png",alt:""}})]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Docker是轻量级的沙盒，在其中运行的只是应用，资源使用率较低")])]),s._v(" "),a("li",[a("p",[s._v("虚拟机中还有额外独立操作系统运行")])]),s._v(" "),a("li",[a("p",[s._v("Docker"),a("code",[s._v("资源利用率更高")])]),s._v(" "),a("p",[s._v("台物理机可以运行数百个容器，但是一般只能运行数十个虚拟机。")])]),s._v(" "),a("li",[a("p",[s._v("Docker"),a("code",[s._v("开销更小")])]),s._v(" "),a("p",[s._v("不需要启动单独的虚拟机占用硬件资源。")])]),s._v(" "),a("li",[a("p",[s._v("Docker"),a("code",[s._v("启动速度更快")])]),s._v(" "),a("p",[s._v("可以在数秒内完成启动。")])])]),s._v(" "),a("p",[a("img",{attrs:{src:"http://static.staryjie.com/static/images/20210131111656.png",alt:""}})]),s._v(" "),a("p",[s._v("使用虚拟机是为了更好的实现服务运行环境隔离，每个虚拟机都有独立的内核，虚拟化可以实现不同操作系统的虚拟机，但是通常一个虚拟机只运行一个服务，很明显资源使用率比较低且造成不必要的性能损耗，我们创建虚拟机的目的是为了运行应用程序，比如Nginx、PHP、TomCat等web程序，使用虚拟机无疑带来了一些不必要的资源开销，但是容器技术则基于减少中间运行环节带来了较大的性能提升。")]),s._v(" "),a("h2",{attrs:{id:"_2、简述kubernetes与docker的关系"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2、简述kubernetes与docker的关系"}},[s._v("#")]),s._v(" 2、简述Kubernetes与Docker的关系？")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("Docker通过Dockerfile将应用程序运行所需要的设置和依赖打包到一个镜像中，从而实现了可移植的特性。")])]),s._v(" "),a("li",[a("p",[s._v("Kubernetes用于关联和编排在多个主机上运行的容器。")])]),s._v(" "),a("li",[a("p",[s._v("Docker作为Kubernetes的CRI ( Container Runtime Interface) 实现之一，但是Kubernetes的CRI并非只有Docker。")])])]),s._v(" "),a("h2",{attrs:{id:"_3、kube-proxy采用ipvs和iptables的区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3、kube-proxy采用ipvs和iptables的区别"}},[s._v("#")]),s._v(" 3、kube-proxy采用ipvs和iptables的区别？")]),s._v(" "),a("p",[s._v("iptables是为防火墙而设计的；")]),s._v(" "),a("p",[s._v("ipvs则是专门用于高性能负载均衡，并使用更高效的数据结构（Hash表），允许无限的规模扩张。")]),s._v(" "),a("p",[s._v("相同之处：")]),s._v(" "),a("ul",[a("li",[s._v("ipvs和iptables都是基于netfilter内核模块转发流量的。")])]),s._v(" "),a("p",[s._v("与iptables相比，ipvs有以下明显优势：")]),s._v(" "),a("ul",[a("li",[s._v("为大型集群提供了更好的可扩展性和性能")]),s._v(" "),a("li",[s._v("支持比iptables更复杂的负载均衡算法（最小负载、最少连接、加权等等）")]),s._v(" "),a("li",[s._v("支持服务器监控检查和连接重试等功能")]),s._v(" "),a("li",[s._v("可以动态修改ipset的集合")])]),s._v(" "),a("p",[s._v("iptables:")]),s._v(" "),a("p",[s._v("优点：")]),s._v(" "),a("ul",[a("li",[s._v("灵活")]),s._v(" "),a("li",[s._v("功能强大（对TCP不同阶段的包进行操作）")])]),s._v(" "),a("p",[s._v("缺点：")]),s._v(" "),a("ul",[a("li",[s._v("表中规则较多时，查询缓慢，影响性能")])]),s._v(" "),a("p",[s._v("ipvs")]),s._v(" "),a("p",[s._v("优点：")]),s._v(" "),a("ul",[a("li",[s._v("转发效率高")]),s._v(" "),a("li",[s._v("调度算法丰富： rr, wrr, lc, wlc, ip_hash ...")])]),s._v(" "),a("p",[s._v("缺点：")]),s._v(" "),a("ul",[a("li",[s._v("低版本内核支持不全，需要升级内核版本")])]),s._v(" "),a("blockquote",[a("p",[s._v("扩展：Kubernetes还有哪些代理模式？")]),s._v(" "),a("ul",[a("li",[s._v("UserSpace：Kubernetes早期版本使用")]),s._v(" "),a("li",[s._v("KernelSpace：专用于Windows")]),s._v(" "),a("li",[s._v("iptables")]),s._v(" "),a("li",[s._v("ipvs")])])]),s._v(" "),a("h2",{attrs:{id:"_4、简述kube-proxy切换为ipvs负载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4、简述kube-proxy切换为ipvs负载"}},[s._v("#")]),s._v(" 4、简述kube-proxy切换为ipvs负载")]),s._v(" "),a("p",[s._v("Kubernetes默认的kube-proxy模式是使用iptables的，但是iptables的性能在大规模集群中会变得很差，而且有时候会出现一些问题，比如 clusterip 不能 ping 通。所以一般在安装Kubernetes的时候会将 kube-proxy 模式切换为 ipvs。")]),s._v(" "),a("p",[s._v("大致步骤如下：")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("查看kube-proxy信息")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl get pods "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" kube-system "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" wide "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" proxy\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("使用kubectl logs可以查看当前kube-proxy的proxy模式")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl logs "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" kube-system kube-proxy-6kwzc\n\nI0923 00:08:06.511166       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" node.go:172"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Successfully retrieved "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" IP: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".126.20\nI0923 00:08:06.511240       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" server_others.go:142"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" kube-proxy "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" IP is an IPv4 address "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".126.20"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", assume IPv4 operation\nW0923 00:08:06.915071       "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" server_others.go:578"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Unknown proxy mode "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),s._v(", assuming iptables proxy\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("blockquote",[a("p",[s._v('Unknown proxy mode "", assuming iptables proxy，默认情况下就是'),a("code",[s._v("iptables")]),s._v("代理模式。")])])]),s._v(" "),a("li",[a("p",[s._v("所有节点启用ipvs模块")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/sysconfig/modules/ipvs.modules")]),s._v('\n#!/bin/bash\nipvs_modules="/usr/lib/modules/\\'),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("uname")]),s._v(" -r"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v('/kernel/net/netfilter/ipvs/"\necho \\'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ipvs_modules")]),s._v("\nfor kernel_module in \\"),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("$ipvs_modules "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-r")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s#(.*).ko.xz#\\1#'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("; do\n  /sbin/modinfo -F filename \\"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${kernel_module}")]),s._v(" > /dev/null 2>&1\n  if [ 0 -eq 0 ]; then\n    /sbin/modprobe \\"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${kernel_module}")]),s._v("\n  fi\ndone\nEOF")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 给予可执行权限")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x /etc/sysconfig/modules/ipvs.modules\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("确保所有节点的ipvs模块以及成功运行")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("lsmod "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" ip_vs\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("修改kube-proxy的配置文件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl edit configmaps kube-proxy "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" kube-system\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 将 mode: ""，修改为 mode: "ipvs"')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("删除旧的Pod")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl delete pods "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" kube-system "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),s._v("kubectl get pods "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" kube-system "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kube-proxy"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("awk")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{print $1}'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者使用下面的命令")]),s._v("\nkubectl delete pods "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" k8s-app"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kube-proxy "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" kube-system\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 确保新的kube-proxy的Pod正常启动运行")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("查看ipvs模式是否生效")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl logs "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v(" kube-system kube-proxy-7thk6\n\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" ipvsadm\n\nipvsadm "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-L")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-n")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])])])]),s._v(" "),a("h2",{attrs:{id:"_5、简述微服务部署中的蓝绿发布"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5、简述微服务部署中的蓝绿发布"}},[s._v("#")]),s._v(" 5、简述微服务部署中的蓝绿发布")]),s._v(" "),a("p",[s._v("蓝绿发布（Blue/Green Deployment）")]),s._v(" "),a("p",[s._v("蓝绿部署中，一共有两套系统：")]),s._v(" "),a("ul",[a("li",[s._v("正在线上提供服务的系统，标记为"),a("font",{staticStyle:{color:"green"}},[s._v("绿色")])],1),s._v(" "),a("li",[s._v("准备发布的新版本，标记为"),a("font",{staticStyle:{color:"blue"}},[s._v("蓝色")])],1)]),s._v(" "),a("p",[s._v("两套系统都是功能完善的、正在运行的系统，只是系统版本和对外提供的服务不同。")]),s._v(" "),a("p",[s._v("开发新版本，需要使用新版本替换线上的旧版本，在线上的旧系统之外，搭建一个使用新版本代码的系统。这时候，一共有两套系统正在运行，正在对外提供服务的旧版本是绿色系统，新部署的是蓝色系统。")]),s._v(" "),a("p",[s._v("蓝色系统不对外提供服务，用来做发布前的测试，测试过程中有任何问题，都可以直接在蓝色系统中直接修改，不干扰用户正在使用的绿色系统。")]),s._v(" "),a("p",[s._v("蓝色系统经过反复的测试、修改、验证，确定达到上线标准之后，直接将用户流量切换到蓝色系统。确定没有问题之后，绿色系统就可以停机下线。")]),s._v(" "),a("h2",{attrs:{id:"_6、简述蓝绿发布的特点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6、简述蓝绿发布的特点"}},[s._v("#")]),s._v(" 6、简述蓝绿发布的特点")]),s._v(" "),a("p",[s._v("蓝绿部署无需停机，并且风险最小")]),s._v(" "),a("p",[s._v("蓝绿发布的优势")]),s._v(" "),a("ul",[a("li",[s._v("升级、切换和回退速度非常快")])]),s._v(" "),a("p",[s._v("不足：")]),s._v(" "),a("ul",[a("li",[s._v("全量切换需要两倍的机器资源")])]),s._v(" "),a("h3",{attrs:{id:"演示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#演示"}},[s._v("#")]),s._v(" 演示")]),s._v(" "),a("p",[a("code",[s._v("green.yaml")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deployment\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" demoapp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v1\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" demoapp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v1\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" demoapp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v1\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" demoapp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v1\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ikubernetes/demoapp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v1.0\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("limits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("memory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"128Mi"')]),s._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cpu")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"500m"')]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Service\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" demoapp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("visit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("svc\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NodePort\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" demoapp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v1\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("protocol")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" TCP\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("targetPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nodePort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31980")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br")])]),a("p",[s._v("浏览器访问："),a("img",{attrs:{src:"http://static.staryjie.com/static/images/20220923093636.png",alt:""}})]),s._v(" "),a("p",[s._v("此时需要更新版本：")]),s._v(" "),a("p",[a("code",[s._v("blue.yaml")])]),s._v(" "),a("div",{staticClass:"language-yaml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deployment\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" demoapp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v2\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" default\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" demoapp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v2\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v2\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" demoapp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v2\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v2\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" demoapp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("v2\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" ikubernetes/demoapp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("v1.1\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("limits")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("memory")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"128Mi"')]),s._v("\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cpu")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"500m"')]),s._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl apply "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v(" blue.yaml\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("部署完bule版本，并且测试通过之后，需要进行版本切换：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl edit svc demoapp-visit-svc\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 app: demoapp-v1 修改为 app: demoapp-v2")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 version: v1 修改为 version: v2")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("修改完成保存退出，访问的流量马上就发生了变化："),a("img",{attrs:{src:"http://static.staryjie.com/static/images/2022-09-23_09-50-31-298.png",alt:""}})]),s._v(" "),a("h2",{attrs:{id:"_7、简述kubernetes静态pod"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7、简述kubernetes静态pod"}},[s._v("#")]),s._v(" 7、简述Kubernetes静态Pod")]),s._v(" "),a("ul",[a("li",[s._v("由Kubelet创建，并且总是在kubelet所在的节点上运行。")]),s._v(" "),a("li",[s._v("静态Pod的配置文件路径\n"),a("ul",[a("li",[s._v("kubeadm安装的："),a("code",[s._v("/var/lib/kubelet/config.yaml")]),s._v("，其中"),a("code",[s._v("staticPodPath: /etc/kubernetes/manifests")])]),s._v(" "),a("li",[s._v("二进制安装的：需要在"),a("code",[s._v("/usr/li/systemd/system/kubelet.service")]),s._v("文件中添加一行"),a("code",[s._v("--pod-manifest-path=<dir>")]),s._v("指定")])])])]),s._v(" "),a("p",[s._v("如果要创建自己的静态Pod，只需要在对应的配置文件路径下创建自己的配置文件即可。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/etc/kubernetes/manifests/static-web.yaml")]),s._v("\napiVersion: v1\nkind: Pod\nmetadata:\n  name: static-web\n  labels:\n    role: myrole\nspec:\n  containers:\n    - name: static-web\n      image: nginx:1.17.1\n      ports:\n        - name: web\n          protocol: TCP\n          containerPort: 80\nEOF")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br")])]),a("p",[s._v("此时，无需任何操作，kubelet会自动创建该Pod。")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl get pods "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-A")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("停止或者删除静态Pod的方式：")]),s._v(" "),a("ul",[a("li",[s._v("删除"),a("code",[s._v("/etc/kubernetes/manifests/static-web.yaml")]),s._v("文件")])]),s._v(" "),a("p",[s._v("其他方式删除或者停止Pod都会被kubelet自动创建。")]),s._v(" "),a("h2",{attrs:{id:"_8、简述kubernetes数据持久化的方式有哪些"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8、简述kubernetes数据持久化的方式有哪些"}},[s._v("#")]),s._v(" 8、简述Kubernetes数据持久化的方式有哪些？")]),s._v(" "),a("ul",[a("li",[s._v("emptyDir：空目录  临时存储")]),s._v(" "),a("li",[s._v("hostPath：挂载宿主机目录")]),s._v(" "),a("li",[s._v("pv存储：NFS、glusterfs、ceph ......")])]),s._v(" "),a("h2",{attrs:{id:"_9、简述dockerfile中copy和add指令有啥区别"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9、简述dockerfile中copy和add指令有啥区别"}},[s._v("#")]),s._v(" 9、简述Dockerfile中COPY和ADD指令有啥区别")]),s._v(" "),a("ul",[a("li",[s._v("COPY\n"),a("ul",[a("li",[s._v("文件复制，将宿主机的文件复制到容器内")])])]),s._v(" "),a("li",[s._v("ADD\n"),a("ul",[a("li",[s._v("文件复制，将宿主机的文件复制到容器内")]),s._v(" "),a("li",[s._v("支持文件解压缩")]),s._v(" "),a("li",[s._v("支持URL")])])])]),s._v(" "),a("h2",{attrs:{id:"_10、如何为kubernetes集群删除或者添加新的节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10、如何为kubernetes集群删除或者添加新的节点"}},[s._v("#")]),s._v(" 10、如何为Kubernetes集群删除或者添加新的节点")]),s._v(" "),a("h3",{attrs:{id:"_10-1-删除节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-1-删除节点"}},[s._v("#")]),s._v(" 10.1 删除节点")]),s._v(" "),a("p",[s._v("首先确认节点是否故障不能开机，如果不能开机需要维修的，直接在master节点上删除该节点就可以：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl delete nodes k8s-node03\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果节点仍在正常运行并且运行着Pod，那么首先需要将节点上的Pod进行驱逐：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 方法1：在节点上打上污点即可驱逐大部分业务Pod")]),s._v("\nkubectl taint "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("node")]),s._v(" k8s-node03 node-type"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("production:NoExecute\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 方法2：通过kubectl drain将指定节点上的资源迁移至集群中其他节点")]),s._v("\nkubectl drain k8s-node03 --delete-emptydir-data "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--force")]),s._v(" --ignore-daemonsets\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("blockquote",[a("p",[s._v("污点排斥等级排序："),a("code",[s._v("NoExecute")]),s._v("> "),a("code",[s._v("NoSchedule")]),s._v(" > "),a("code",[s._v("PreferNoSchedule")])])]),s._v(" "),a("p",[s._v("然后删除节点：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("kubectl get nodes "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" wide\n\nkubectl delete nodes k8s-node03\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("确认Pod驱逐完成之后，将节点重置，并清除数据：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在你需要删除的节点上执行")]),s._v("\nkubeadm reset "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-f")]),s._v("\n\nsystemctl stop kubelet.service\nsystemctl stop docker.service\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" /var/lib/cni/\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" /var/lib/kubelet/*\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v(" /etc/cni/\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v(" cni0 down\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v(" flannel.1 down\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ifconfig")]),s._v(" docker0 down\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" delete cni0\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ip")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("link")]),s._v(" delete flannel.1\n\nsystem start docker.service\n\niptables "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-F")]),s._v("\niptables "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" nat "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-F")]),s._v("\niptables "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" mangle "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-F")]),s._v("\niptables "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-X")]),s._v("\nipvsadm "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-C")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br")])]),a("h3",{attrs:{id:"_10-2-添加新的节点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-2-添加新的节点"}},[s._v("#")]),s._v(" 10.2 添加新的节点")]),s._v(" "),a("p",[s._v("需要在需要加入的节点上做好环境准备工作，必须一些必须的Kubernetes组件的安装等等。")]),s._v(" "),a("p",[s._v("如果是"),a("code",[s._v("kubeadm")]),s._v("安装的节点，需要查看加入集群的token是否失效：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看token的名称")]),s._v("\nkubeadm token list\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看token的值")]),s._v("\nopenssl x509 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-pubkey")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-in")]),s._v(" /etc/kubernetes/pki/ca.crt "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" openssl rsa "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-pubin")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-outform")]),s._v(" der "),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("2")]),s._v(">")]),s._v("/dev/null "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" openssl dgst "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-sha256")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-hex")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/^.* //'")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("如果Token失效了，那么就需要通过"),a("code",[s._v("kubeadm")]),s._v("目录重新生成Token：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成临时的Token，有效期24小时")]),s._v("\nkubeadm token create --print-join-command\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生成永久的Token")]),s._v("\nkubeadm token create --print-join-command "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--ttl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("然后根据要将该节点加入到工作节点还是控制节点，执行不同的命令加入集群：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加入控制节点")]),s._v("\nkubeadm "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".126.10:6443 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--token")]),s._v(" mhls2v.xqoxslpkzj89l9bc     --discovery-token-ca-cert-hash sha256:7207de86a81efadf0ec20bb117a33501fc6352ef218b1505b38e779554876a71 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --control-plane\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加入工作节点")]),s._v("\nkubeadm "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".126.10:6443 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--token")]),s._v(" mhls2v.xqoxslpkzj89l9bc     --discovery-token-ca-cert-hash sha256:7207de86a81efadf0ec20bb117a33501fc6352ef218b1505b38e779554876a71 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --control-plane\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);